<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Command Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #f3f6f9; font-family: 'Segoe UI', sans-serif; }
        
        /* SIDEBAR */
        .sidebar { height: 100vh; position: fixed; width: 260px; background: #000080; color: white; padding-top: 25px; z-index: 999; }
        .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 1rem; color: rgba(255,255,255,0.7); display: block; cursor: pointer; transition: 0.3s; }
        .sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.1); border-left: 5px solid #FF9933; color: white; }
        .brand-side { font-size: 1.5rem; font-weight: 800; padding: 0 25px 30px; }

        .main-content { margin-left: 260px; padding: 30px; }
        
        /* SECTIONS Logic */
        .section-view { display: none; animation: fadeIn 0.4s; }
        .section-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS */
        .stat-card { background: white; border-radius: 12px; padding: 25px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .stat-val { font-size: 2.2rem; font-weight: 700; margin: 0; }
        
        /* TABLE */
        .table-container { background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; }
        .table th { background: #f8f9fa; color: #666; font-size: 0.85rem; font-weight: 700; border: none; padding: 15px; text-transform: uppercase; }
        .table td { vertical-align: middle; padding: 15px; border-bottom: 1px solid #f0f0f0; }

        .row-resolved { background: #fcfcfc; opacity: 0.6; }
        .strike { text-decoration: line-through; color: #999; }
        
        /* ANALYTICS BARS */
        .progress { height: 25px; border-radius: 12px; margin-bottom: 20px; background-color: #f1f1f1; }
        .progress-bar { font-weight: bold; line-height: 25px; text-align: left; padding-left: 15px; }
        
        /* OFFICER CARDS */
        .officer-card { background: white; border-radius: 10px; padding: 20px; border: 1px solid #eee; transition: 0.2s; }
        .officer-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: #000080; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand-side">CivicFix<span style="color:#FF9933">.AI</span></div>
        <a onclick="showSection('dashboard')" id="link-dashboard" class="active"><i class="fas fa-th-large me-2"></i> Dashboard</a>
        <a onclick="showSection('analytics')" id="link-analytics"><i class="fas fa-chart-pie me-2"></i> Analytics & Trends</a>
        <a onclick="showSection('officers')" id="link-officers"><i class="fas fa-user-shield me-2"></i> Officers & Contact</a>
        <a onclick="showSection('settings')" id="link-settings"><i class="fas fa-cog me-2"></i> System Settings</a>
        <a href="/logout" style="margin-top: 50px;"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
    </div>

    <div class="main-content">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark" id="page-title">Command Center</h3>
            <div class="text-muted small">Admin: <b>Superintendent</b></div>
        </div>

        <div id="dashboard" class="section-view active">
            <div class="row g-4 mb-4">
                <div class="col-md-4">
                    <div class="stat-card border-start border-4 border-primary">
                        <h2 class="stat-val" th:text="${total}">0</h2>
                        <small class="text-muted fw-bold">TOTAL GRIEVANCES</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card border-start border-4 border-danger">
                        <h2 class="stat-val text-danger" th:text="${critical}">0</h2>
                        <small class="text-muted fw-bold">CRITICAL ALERTS</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-card border-start border-4 border-success">
                        <h2 class="stat-val text-success">98%</h2>
                        <small class="text-muted fw-bold">RESOLUTION RATE</small>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <div class="p-3 bg-white border-bottom d-flex justify-content-between align-items-center">
                    <span class="fw-bold">üì¢ Live Issue Feed</span>
                    <select id="deptFilter" class="form-select form-select-sm w-auto shadow-none bg-light" onchange="filterTable()">
                        <option value="all">Filter: Show All</option>
                        <option value="Roads">Roads Dept</option>
                        <option value="Sanitation">Sanitation</option>
                        <option value="Water">Water Board</option>
                    </select>
                </div>

                <table class="table mb-0">
                    <thead>
                        <tr><th>Severity</th><th>Issue</th><th>Dept</th><th>Status</th><th>Actions</th></tr>
                    </thead>
                    <tbody>
                        <tr th:each="r : ${reports}" class="issue-row" th:data-dept="${r.dept}" th:classappend="${r.status == 'Resolved'} ? 'row-resolved' : ''">
                            <td class="fw-bold text-danger" th:text="${r.severity} + '/100'"></td>
                            <td>
                                <div class="fw-bold" th:classappend="${r.status == 'Resolved'} ? 'strike' : ''" th:text="${r.type}"></div>
                                <div class="small text-muted" th:text="${r.location}"></div>
                            </td>
                            <td th:text="${r.dept}"></td>
                            <td>
                                <span th:if="${r.status == 'Resolved'}" class="text-success fw-bold">Solved</span>
                                <span th:if="${r.status != 'Resolved'}" class="text-danger fw-bold" th:text="${r.status}"></span>
                            </td>
                            <td>
                                <div th:if="${r.status != 'Resolved'}">
                                    <a th:href="@{'/resolve/' + ${r.id}}" class="btn btn-sm btn-success me-1" title="Resolve"><i class="fas fa-check"></i></a>
                                    <a th:href="@{'/escalate/' + ${r.id}}" class="btn btn-sm btn-warning text-white me-1" title="Escalate"><i class="fas fa-bullhorn"></i></a>
                                    <a th:href="@{'/delete/' + ${r.id}}" class="btn btn-sm btn-outline-danger" title="Delete" onclick="return confirm('Delete this report?')"><i class="fas fa-trash"></i></a>
                                </div>
                                <span th:if="${r.status == 'Resolved'}" class="badge bg-secondary">Closed</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="analytics" class="section-view">
            <h5 class="fw-bold mb-4">üìä Issue Distribution Trends</h5>
            
            <div class="card p-4 border-0 shadow-sm">
                <label class="fw-bold mb-2">Roads & Transport Issues (45%)</label>
                <div class="progress">
                    <div class="progress-bar bg-warning text-dark" style="width: 45%">45 Issues</div>
                </div>

                <label class="fw-bold mb-2">Sanitation & Garbage (30%)</label>
                <div class="progress">
                    <div class="progress-bar bg-info text-white" style="width: 30%">30 Issues</div>
                </div>

                <label class="fw-bold mb-2">Water Supply & Leakage (20%)</label>
                <div class="progress">
                    <div class="progress-bar bg-primary" style="width: 20%">20 Issues</div>
                </div>

                <label class="fw-bold mb-2">Electricity & Other (5%)</label>
                <div class="progress">
                    <div class="progress-bar bg-secondary" style="width: 5%">5 Issues</div>
                </div>
            </div>
        </div>

        <div id="officers" class="section-view">
            <h5 class="fw-bold mb-4">üëÆ Zonal Officers Directory</h5>
            <div class="row g-4">
                <div class="col-md-6" th:each="off : ${officers}">
                    <div class="officer-card d-flex align-items-center">
                        <div class="bg-light rounded-circle p-3 me-3 text-primary">
                            <i class="fas fa-user-tie fa-2x"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="fw-bold mb-0" th:text="${off.name}">Name</h5>
                            <div class="text-muted small mb-2" th:text="${off.role} + ' ‚Ä¢ ' + ${off.dept}">Role</div>
                            <a th:href="'tel:' + ${off.phone}" class="btn btn-sm btn-outline-success me-1"><i class="fas fa-phone-alt"></i> Call</a>
                            <a th:href="'mailto:' + ${off.email}" class="btn btn-sm btn-outline-primary"><i class="fas fa-envelope"></i> Email</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings" class="section-view">
            <h5 class="fw-bold mb-4">‚öôÔ∏è System Configuration</h5>
            <div class="card p-4 border-0 shadow-sm">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h6 class="fw-bold mb-0">Emergency Lockdown</h6>
                        <small class="text-muted">Disable all user reporting temporarily.</small>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" style="width: 50px; height: 25px;">
                    </div>
                </div>
                <hr>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h6 class="fw-bold mb-0">Auto-Escalation AI</h6>
                        <small class="text-muted">Automatically escalate issues older than 48hrs.</small>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" checked style="width: 50px; height: 25px;">
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function showSection(id) {
            document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar a').forEach(el => el.classList.remove('active'));
            
            document.getElementById(id).classList.add('active');
            document.getElementById('link-' + id).classList.add('active');
            
            var titles = {
                'dashboard': 'Command Center', 'analytics': 'Data Analytics', 
                'officers': 'Contact Directory', 'settings': 'System Settings'
            };
            document.getElementById('page-title').innerText = titles[id];
        }

        function filterTable() {
            var input = document.getElementById("deptFilter").value;
            var rows = document.getElementsByClassName("issue-row");
            for (var i = 0; i < rows.length; i++) {
                var dept = rows[i].getAttribute("data-dept");
                rows[i].style.display = (input === "all" || dept.includes(input)) ? "" : "none";
            }
        }
    </script>
</body>
</html>